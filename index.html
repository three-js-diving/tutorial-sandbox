<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>ThreeJS Diving: Lesson 2, step 4 of 4: The Big Bang</title>
    <!-- For the latest version of `three` check [CDN](https://www.jsdelivr.com/package/npm/three) -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@v0.182.0/build/three.module.min.js"
        }
      }
    </script>
    <script type="module">
      import * as THREE from "three";

      const renderer = new THREE.WebGLRenderer();
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(100, 2);

      /**
       * Let's move away further from the center of the Big Bang
       */
      camera.position.z = 2000;

      const deltaX = Symbol("deltaX");
      const deltaY = Symbol("deltaY");
      const deltaZ = Symbol("deltaZ");

      const particles = particlesFactory();

      scene.add(...particles);

      render(0);

      document.body.append(renderer.domElement);

      function particlesFactory() {
        const particles = [];
        const geometry = new THREE.SphereGeometry(10);
        const material = new THREE.MeshBasicMaterial({ color: 0xfbec5d });

        for (let i = 0; i < 10000; i++) {
          const scale = getRandomNumber(0.1, 1.5);
          const particle = new THREE.Mesh(geometry, material);

          particle.scale.setScalar(scale);

          /**
           * Let's add randomness
           */
          const speed = getRandomNumber(0.1, 100);

          particle[deltaX] = speed * getRandomNumber(-2, 2);
          particle[deltaY] = speed * getRandomNumber(-2, 2);
          particle[deltaZ] = speed * getRandomNumber(-2, 2);

          particles.push(particle);
        }

        return particles;
      }

      function getRandomNumber(min, max) {
        return min + Math.random() * (max - min);
      }

      function render(time) {
        /**
         * Let's add movement
         */
        move(particles);
        renderer.render(scene, camera);
        requestAnimationFrame(render);
      }

      function move(particles) {
        particles.forEach((particle) => {
          particle.position.x += particle[deltaX];
          particle.position.y += particle[deltaY];
          particle.position.z += particle[deltaZ];
        });
      }
    </script>
  </head>
</html>
